

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>alogos._optimization.ea.database &mdash; alogos 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="../../../../_static/alogos.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst/package_references.html">Package References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst/quickstart.html">Quickstart Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst/getting_started.html">Getting Started Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rst/examples.html">Code Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../autoapi/index.html">API Documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">alogos</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>alogos._optimization.ea.database</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for alogos._optimization.ea.database</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="k">as</span> <span class="nn">_json</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span> <span class="k">as</span> <span class="nn">_sqlite3</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span> <span class="k">as</span> <span class="n">_Iterable</span>

<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">_utilities</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">exceptions</span> <span class="k">as</span> <span class="n">_exceptions</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">warnings</span> <span class="k">as</span> <span class="n">_warnings</span>
<span class="kn">from</span> <span class="nn">..._utilities</span> <span class="kn">import</span> <span class="n">argument_processing</span> <span class="k">as</span> <span class="n">_ap</span>
<span class="kn">from</span> <span class="nn">..._utilities.database_management</span> <span class="kn">import</span> <span class="n">Sqlite3Wrapper</span> <span class="k">as</span> <span class="n">_Sqlite3Wrapper</span>
<span class="kn">from</span> <span class="nn">..._utilities.operating_system</span> <span class="kn">import</span> <span class="n">NEWLINE</span> <span class="k">as</span> <span class="n">_NEWLINE</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">database</span> <span class="k">as</span> <span class="n">_database</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">plots</span> <span class="k">as</span> <span class="n">_plots</span>


<div class="viewcode-block" id="Database"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database">[docs]</a><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Database wrapper for easily storing algorithm results.&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_location&quot;</span><span class="p">,</span> <span class="s2">&quot;_system&quot;</span><span class="p">,</span> <span class="s2">&quot;_dbms&quot;</span><span class="p">,</span> <span class="s2">&quot;_cache&quot;</span><span class="p">,</span> <span class="s2">&quot;_deserializer&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Database.__init__"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a database object referring to a file-based or in-memory SQLite3 database.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">location</span>

        <span class="c1"># Cache: Store results of repeated calculations, but recalculate after database changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Create or connect to SQLite3 database, try to create tables and views</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span> <span class="o">=</span> <span class="n">_Sqlite3Wrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_try_creating_tables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_try_creating_views</span><span class="p">()</span>

        <span class="c1"># Deserializer: Convert database entries back to Python objects</span>
        <span class="k">if</span> <span class="n">system</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s2">&quot;cfggpst&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span> <span class="o">=</span> <span class="n">Deserializer</span><span class="p">(</span><span class="n">system</span><span class="p">)</span></div>

    <span class="c1"># Representations</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the &quot;official&quot; string representation of the database wrapper.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;EvolutionaryAlgorithmDatabase object at </span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the &quot;informal&quot; string representation of the database wrapper.&quot;&quot;&quot;</span>
        <span class="n">max_shown_phenotypes</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="c1"># Read data</span>
        <span class="n">num_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">get_num_changes</span><span class="p">()</span>
        <span class="n">num_generations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_generations</span><span class="p">()</span>
        <span class="n">num_individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_individuals</span><span class="p">()</span>
        <span class="n">num_genotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_genotypes</span><span class="p">()</span>
        <span class="n">num_phenotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_phenotypes</span><span class="p">()</span>
        <span class="n">num_fitness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_fitnesses</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pop_size_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">population_size_min</span><span class="p">()</span>
            <span class="n">pop_size_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">population_size_max</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">pop_size_min</span> <span class="o">=</span> <span class="s2">&quot;not available&quot;</span>
            <span class="n">pop_size_max</span> <span class="o">=</span> <span class="s2">&quot;not available&quot;</span>
        <span class="n">min_individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals_with_min_fitness</span><span class="p">()</span>
        <span class="n">min_genotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotypes_with_min_fitness</span><span class="p">()</span>
        <span class="n">min_phenotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phenotypes_with_min_fitness</span><span class="p">()</span>
        <span class="n">num_min_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_individuals</span><span class="p">)</span>
        <span class="n">num_min_genotypes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_genotypes</span><span class="p">)</span>
        <span class="n">num_min_phenotypes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_phenotypes</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">min_fitness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_min</span><span class="p">()</span>
            <span class="n">max_fitness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_max</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">min_fitness</span> <span class="o">=</span> <span class="s2">&quot;not available&quot;</span>
            <span class="n">max_fitness</span> <span class="o">=</span> <span class="s2">&quot;not available&quot;</span>
        <span class="n">max_individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals_with_max_fitness</span><span class="p">()</span>
        <span class="n">max_genotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotypes_with_max_fitness</span><span class="p">()</span>
        <span class="n">max_phenotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phenotypes_with_max_fitness</span><span class="p">()</span>
        <span class="n">num_max_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_individuals</span><span class="p">)</span>
        <span class="n">num_max_genotypes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_genotypes</span><span class="p">)</span>
        <span class="n">num_max_phenotypes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_phenotypes</span><span class="p">)</span>

        <span class="c1"># Write message</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;╭─ Database of the evolutionary search</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Number of changes ............ </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_changes</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Number of generations ........ </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_generations</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Number of individuals ........ </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_individuals</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Number of unique genotypes ... </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_genotypes</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Number of unique phenotypes .. </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_phenotypes</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Number of unique fitnesses ... </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Minimum population size ...... </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pop_size_min</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;│ Maximum population size ...... </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pop_size_max</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_fitness</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ Minimum fitness .............. </span><span class="si">{:.6f}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">min_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│   shared by </span><span class="si">{}</span><span class="s2"> individuals, </span><span class="si">{}</span><span class="s2"> genotypes, </span><span class="si">{}</span><span class="s2"> phenotypes</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">num_min_ind</span><span class="p">,</span> <span class="n">num_min_genotypes</span><span class="p">,</span> <span class="n">num_min_phenotypes</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ Maximum fitness .............. </span><span class="si">{:.6f}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">max_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│   shared by </span><span class="si">{}</span><span class="s2"> individuals, </span><span class="si">{}</span><span class="s2"> genotypes, </span><span class="si">{}</span><span class="s2"> phenotypes</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">num_max_ind</span><span class="p">,</span> <span class="n">num_max_genotypes</span><span class="p">,</span> <span class="n">num_max_phenotypes</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ Minimum fitness .............. </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ Maximum fitness .............. </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># First individual with min fitness</span>
        <span class="k">if</span> <span class="n">min_individuals</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>
            <span class="n">first_min_individual</span> <span class="o">=</span> <span class="n">min_individuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ First individual with minimum fitness </span><span class="si">{:.6f}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">min_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">first_min_individual</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│   </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">))</span>

        <span class="c1"># All phenotypes with min fitness</span>
        <span class="k">if</span> <span class="n">num_min_phenotypes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">num_min_phenotypes</span> <span class="o">&lt;=</span> <span class="n">max_shown_phenotypes</span><span class="p">:</span>
                <span class="n">num_shown_phenotypes</span> <span class="o">=</span> <span class="n">num_min_phenotypes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_shown_phenotypes</span> <span class="o">=</span> <span class="n">max_shown_phenotypes</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ First </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> phenotypes with minimum fitness </span><span class="si">{:.6f}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">num_shown_phenotypes</span><span class="p">,</span> <span class="n">num_min_phenotypes</span><span class="p">,</span> <span class="n">min_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">phe</span> <span class="ow">in</span> <span class="n">min_phenotypes</span><span class="p">[:</span><span class="n">max_shown_phenotypes</span><span class="p">]:</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│   Phenotype: </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phe</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">num_min_phenotypes</span> <span class="o">&gt;</span> <span class="n">max_shown_phenotypes</span><span class="p">:</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│   ...</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>

        <span class="c1"># First individual with max fitness</span>
        <span class="k">if</span> <span class="n">max_individuals</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>
            <span class="n">first_max_individual</span> <span class="o">=</span> <span class="n">max_individuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ First individual with maximum fitness </span><span class="si">{:.6f}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">max_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">first_max_individual</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│   </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">))</span>

        <span class="c1"># All phenotypes with max fitness</span>
        <span class="k">if</span> <span class="n">num_max_phenotypes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">num_max_phenotypes</span> <span class="o">&lt;=</span> <span class="n">max_shown_phenotypes</span><span class="p">:</span>
                <span class="n">num_shown_phenotypes</span> <span class="o">=</span> <span class="n">num_max_phenotypes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_shown_phenotypes</span> <span class="o">=</span> <span class="n">max_shown_phenotypes</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;│ First </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2"> phenotypes with maximum fitness </span><span class="si">{:.6f}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">num_shown_phenotypes</span><span class="p">,</span> <span class="n">num_max_phenotypes</span><span class="p">,</span> <span class="n">max_fitness</span><span class="p">,</span> <span class="n">_NEWLINE</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">phe</span> <span class="ow">in</span> <span class="n">max_phenotypes</span><span class="p">[:</span><span class="n">max_shown_phenotypes</span><span class="p">]:</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│   Phenotype: </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phe</span><span class="p">,</span> <span class="n">_NEWLINE</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">num_max_phenotypes</span> <span class="o">&gt;</span> <span class="n">max_shown_phenotypes</span><span class="p">:</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;│   ...</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_NEWLINE</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;╰─&quot;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provide rich display representation for IPython and Jupyter.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cycle</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="c1"># Creation of tables and views</span>
    <span class="k">def</span> <span class="nf">_try_creating_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try to create tables in the database.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Table 1: search - contains the main data produced by a search</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;CREATE TABLE search ( &quot;</span>
                <span class="s2">&quot;  individual_id INTEGER PRIMARY KEY, &quot;</span>
                <span class="s2">&quot;  parent_ids TEXT, &quot;</span>
                <span class="s2">&quot;  generation INTEGER, &quot;</span>
                <span class="s2">&quot;  label TEXT, &quot;</span>
                <span class="s2">&quot;  genotype TEXT, &quot;</span>
                <span class="s2">&quot;  FOREIGN KEY(genotype) REFERENCES genotype_phenotype_mapping(genotype)&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Table 2: genotype_phenotype_mapping - contains repetitive mapping data</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;CREATE TABLE genotype_phenotype_mapping ( &quot;</span>
                <span class="s2">&quot;  genotype TEXT PRIMARY KEY, &quot;</span>
                <span class="s2">&quot;  phenotype TEXT, &quot;</span>
                <span class="s2">&quot;  FOREIGN KEY(phenotype) REFERENCES phenotype_fitness_mapping(phenotype)&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Table 3: phenotype_fitness_mapping - contains repetitive mapping data</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;CREATE TABLE phenotype_fitness_mapping ( &quot;</span>
                <span class="s2">&quot;  phenotype TEXT PRIMARY KEY, &quot;</span>
                <span class="s2">&quot;  fitness REAL,&quot;</span>
                <span class="s2">&quot;  details TEXT &quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">_sqlite3</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">:</span>
            <span class="c1"># If tables already exist, ignore the error on trying to create them again</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_try_creating_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try to create views in the database.</span>

<span class="sd">        These views join some tables for simpler access to their data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># View 1: full_search - combines search data with repetitive mapping data</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;CREATE VIEW full_search AS &quot;</span>
                <span class="s2">&quot;SELECT &quot;</span>
                <span class="s2">&quot;  search.individual_id, &quot;</span>
                <span class="s2">&quot;  search.parent_ids, &quot;</span>
                <span class="s2">&quot;  search.generation, &quot;</span>
                <span class="s2">&quot;  search.label, &quot;</span>
                <span class="s2">&quot;  search.genotype, &quot;</span>
                <span class="s2">&quot;  genotype_phenotype_mapping.phenotype, &quot;</span>
                <span class="s2">&quot;  phenotype_fitness_mapping.fitness, &quot;</span>
                <span class="s2">&quot;  phenotype_fitness_mapping.details &quot;</span>
                <span class="s2">&quot;FROM search &quot;</span>
                <span class="s2">&quot;LEFT JOIN genotype_phenotype_mapping &quot;</span>
                <span class="s2">&quot;  ON genotype_phenotype_mapping.genotype=search.genotype &quot;</span>
                <span class="s2">&quot;LEFT JOIN phenotype_fitness_mapping &quot;</span>
                <span class="s2">&quot;  ON phenotype_fitness_mapping.phenotype=genotype_phenotype_mapping.phenotype;&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">_sqlite3</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">:</span>
            <span class="c1"># If view already exists, ignore the error on trying to create it again</span>
            <span class="k">pass</span>

    <span class="c1"># Storing database entries during a search, loading them during analysis</span>
    <span class="k">def</span> <span class="nf">_store_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="n">generation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store all individuals of a population in the database.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Each individual requires multiple INSERT statements. If they</span>
<span class="sd">          were commited as separate transactions, it would take a lot of</span>
<span class="sd">          time. Instead, the data of all individuals can be collected</span>
<span class="sd">          and stored in a single transaction.</span>

<span class="sd">        - The details attribute of each individual can contain an</span>
<span class="sd">          evaluation key that refers to user-defined data returned by</span>
<span class="sd">          the objective function. It is attempted to be JSON serialized</span>
<span class="sd">          and in case it fails the data of this attribute is not stored</span>
<span class="sd">          and an empty dictionary instead without warning.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        - https://www.sqlite.org/faq.html#q19</span>
<span class="sd">        - https://docs.python.org/3/library/sqlite3.html#using-sqlite3-efficiently</span>
<span class="sd">        - https://stackoverflow.com/questions/603572/escape-single-quote-character-for-use-in-an-sqlite-query</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: Serialization is performed inline (not in several methods) to increase run speed,</span>
        <span class="c1"># while deserialization after a run is performed in methods to increase modularity</span>

        <span class="c1"># Argument processing</span>
        <span class="n">generation</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">generation</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="c1"># Prepare queries</span>
        <span class="n">query1</span> <span class="o">=</span> <span class="s2">&quot;INSERT OR IGNORE INTO phenotype_fitness_mapping VALUES (?, ?, ?);&quot;</span>
        <span class="n">query2</span> <span class="o">=</span> <span class="s2">&quot;INSERT OR IGNORE INTO genotype_phenotype_mapping VALUES (?, ?);&quot;</span>
        <span class="n">query3</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO search VALUES (?, ?, ?, ?, ?);&quot;</span>

        <span class="c1"># Prepare data</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phe_known</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">gt_known</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">population</span><span class="p">:</span>
            <span class="c1"># Serialization: genotype to str in system-specific format</span>
            <span class="n">gt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">genotype</span><span class="p">)</span>
            <span class="c1"># Serialization: parent_ids to str in list format</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parent_ids</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s2">&quot;parent_ids&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">parent_ids</span> <span class="o">=</span> <span class="s2">&quot;[]&quot;</span>
            <span class="c1"># Data for table &quot;search&quot;</span>
            <span class="n">data3</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ind</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent_ids</span><span class="p">),</span> <span class="n">generation</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">gt</span><span class="p">))</span>
            <span class="c1"># Data for other tables</span>
            <span class="n">phe</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">phenotype</span>
            <span class="k">if</span> <span class="n">phe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">phe</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">phe_known</span><span class="p">:</span>
                    <span class="n">phe_known</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">phe</span><span class="p">)</span>
                    <span class="c1"># Serialization: details to None, JSON or str</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="s2">&quot;evaluation&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">details</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">details</span> <span class="o">=</span> <span class="n">_json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">details</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">details</span><span class="p">)</span>
                    <span class="c1"># Data for table &quot;phenotype_fitness_mapping&quot;</span>
                    <span class="n">data1</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">phe</span><span class="p">,</span> <span class="n">ind</span><span class="o">.</span><span class="n">fitness</span><span class="p">,</span> <span class="n">details</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">gt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gt_known</span><span class="p">:</span>
                    <span class="c1"># Data for table &quot;genotype_phenotype_mapping&quot;</span>
                    <span class="n">gt_known</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
                    <span class="n">data2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gt</span><span class="p">,</span> <span class="n">phe</span><span class="p">))</span>

        <span class="c1"># Insert data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query_for_many_records</span><span class="p">(</span><span class="n">query1</span><span class="p">,</span> <span class="n">data1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query_for_many_records</span><span class="p">(</span><span class="n">query2</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query_for_many_records</span><span class="p">(</span><span class="n">query3</span><span class="p">,</span> <span class="n">data3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation</span><span class="p">,</span> <span class="n">with_parent_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a population identified by its generation from the database.</span>

<span class="sd">        The information in from the database is converted to suitable</span>
<span class="sd">        Python objects on the level of individual attributes</span>
<span class="sd">        (e.g. fitness is float), individual objects (type depends on</span>
<span class="sd">        system) and population (type depends on system).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DatabaseError</span>
<span class="sd">            If the loaded population is empty because the database does</span>
<span class="sd">            not contain the user-provided generation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load database entries</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM full_search WHERE generation=? AND label=&quot;main&quot;;&#39;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">generation</span><span class="p">,))</span>

        <span class="c1"># Raise error if empty</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_load_population_error</span><span class="p">(</span><span class="n">generation</span><span class="p">)</span>

        <span class="c1"># Reconstruct population</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_store_database_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store a subset of data to the database.&quot;&quot;&quot;</span>
        <span class="c1"># Split data</span>
        <span class="n">data_search</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;search&quot;</span><span class="p">]</span>
        <span class="n">data_gen_phe</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;genotype_phenotype_mapping&quot;</span><span class="p">]</span>
        <span class="n">data_phe_fit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;phenotype_fitness_mapping&quot;</span><span class="p">]</span>

        <span class="c1"># Table 1: search</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO search VALUES (?, ?, ?, ?, ?);&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query_for_many_records</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data_search</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">_sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_individual_clash_error</span><span class="p">()</span>

        <span class="c1"># Table 2: genotype_phenotype_mapping</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT OR IGNORE INTO genotype_phenotype_mapping VALUES (?, ?);&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query_for_many_records</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data_gen_phe</span><span class="p">)</span>

        <span class="c1"># Table 3: phenotype_fitness_mapping</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT OR IGNORE INTO phenotype_fitness_mapping VALUES (?, ?, ?);&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query_for_many_records</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data_phe_fit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_database_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a subset of data defined by first and last generation from the database.&quot;&quot;&quot;</span>
        <span class="c1"># Table 1: search</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM search WHERE generation&gt;=? AND generation&lt;=?;&quot;</span>
        <span class="n">search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span><span class="p">))</span>

        <span class="c1"># Table 2: genotype_phenotype_mapping</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;WITH chosen_genotypes AS (&quot;</span>
            <span class="s2">&quot;  SELECT DISTINCT genotype FROM search &quot;</span>
            <span class="s2">&quot;  WHERE generation&gt;=? AND generation&lt;=? &quot;</span>
            <span class="s2">&quot;) &quot;</span>
            <span class="s2">&quot;SELECT * FROM genotype_phenotype_mapping WHERE genotype IN chosen_genotypes&quot;</span>
        <span class="p">)</span>
        <span class="n">genotype_phenotype_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Table 3: phenotype_fitness_mapping</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;WITH chosen_genotypes AS (&quot;</span>
            <span class="s2">&quot;  SELECT DISTINCT genotype FROM search &quot;</span>
            <span class="s2">&quot;  WHERE generation&gt;=? AND generation&lt;=? &quot;</span>
            <span class="s2">&quot;), chosen_phenotypes AS (&quot;</span>
            <span class="s2">&quot;  SELECT DISTINCT phenotype FROM genotype_phenotype_mapping &quot;</span>
            <span class="s2">&quot;  WHERE genotype IN chosen_genotypes &quot;</span>
            <span class="s2">&quot;) &quot;</span>
            <span class="s2">&quot;SELECT * FROM phenotype_fitness_mapping WHERE phenotype IN chosen_phenotypes&quot;</span>
        <span class="p">)</span>
        <span class="n">phenotype_fitness_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Combine the results in a dictionary</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">search</span><span class="o">=</span><span class="n">search</span><span class="p">,</span>
            <span class="n">genotype_phenotype_mapping</span><span class="o">=</span><span class="n">genotype_phenotype_mapping</span><span class="p">,</span>
            <span class="n">phenotype_fitness_mapping</span><span class="o">=</span><span class="n">phenotype_fitness_mapping</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_load_database_full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load all data from the database.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_database_subset</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generation_first</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_last</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="c1"># File I/O</span>
<div class="viewcode-block" id="Database.export_sql"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.export_sql">[docs]</a>    <span class="k">def</span> <span class="nf">export_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;sqlite3&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export the evolutionary search by storing the current database to an SQL file.</span>

<span class="sd">        All tables and views are exported to a single SQL file that</span>
<span class="sd">        adheres to</span>
<span class="sd">        `SQLite version 3 &lt;https://docs.python.org/3/library/sqlite3.html&gt;`__.</span>
<span class="sd">        It can be used for a later import in order to continue and</span>
<span class="sd">        analyze a run, or it may be opened with an external tools such</span>
<span class="sd">        as `DB Browser for SQLite &lt;https://sqlitebrowser.org/&gt;`__.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The given filepath may automatically be modified in two</span>
<span class="sd">            ways:</span>

<span class="sd">            - It is ensured to end with the extension defined by the</span>
<span class="sd">              ``ext`` argument.</span>
<span class="sd">            - It is ensured to be a filepath that does not exist yet by</span>
<span class="sd">              adding a numerical suffix.</span>

<span class="sd">              Example: If ``some_file.sqlite3`` exists, it uses</span>
<span class="sd">              ``some_file_1.sqlite3`` or if that also exists then</span>
<span class="sd">              ``some_file_2.sqlite3`` and so on.</span>
<span class="sd">        ext : str</span>
<span class="sd">            The extension that the filepath is ensured to end with.</span>

<span class="sd">            - If ``None``, no extension is added.</span>
<span class="sd">            - If ``db``, the filepath is ensured to end with ``.db``.</span>
<span class="sd">            - If ``.sql``, the filepath is ensured to end with ``.sql``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filepath_used : str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepath_used</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filepath_used</span> <span class="o">=</span> <span class="n">_utilities</span><span class="o">.</span><span class="n">operating_system</span><span class="o">.</span><span class="n">ensure_file_extension</span><span class="p">(</span>
                <span class="n">filepath</span><span class="p">,</span> <span class="n">ext</span>
            <span class="p">)</span>
        <span class="n">filepath_used</span> <span class="o">=</span> <span class="n">_utilities</span><span class="o">.</span><span class="n">operating_system</span><span class="o">.</span><span class="n">ensure_new_path</span><span class="p">(</span><span class="n">filepath_used</span><span class="p">)</span>

        <span class="c1"># Export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">export_sql</span><span class="p">(</span><span class="n">filepath_used</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filepath_used</span></div>

<div class="viewcode-block" id="Database.export_csv"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.export_csv">[docs]</a>    <span class="k">def</span> <span class="nf">export_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export the database of this evolutionary search as CSV file.</span>

<span class="sd">        Only the main view, which gathers information from all</span>
<span class="sd">        individual tables, is exported to a single CSV file. As such</span>
<span class="sd">        it provides all information stored in the database in a</span>
<span class="sd">        redundant manner. Currently it can not be used for a later</span>
<span class="sd">        import, but it can be opened with external tools that can read</span>
<span class="sd">        CSV files, such as</span>
<span class="sd">        `LibreOffice Calc &lt;https://www.libreoffice.org/discover/calc/&gt;`__</span>
<span class="sd">        or</span>
<span class="sd">        `Tad &lt;https://www.tadviewer.com&gt;`__.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            The given filepath may automatically be modified in two ways:</span>

<span class="sd">            - It is ensured to end with the extension defined by the</span>
<span class="sd">              ``ext`` argument.</span>
<span class="sd">            - It is ensured to be a filepath that does not exist yet by</span>
<span class="sd">              adding a numerical suffix.</span>

<span class="sd">              Example: If ``some_file.sqlite3`` exists, it uses</span>
<span class="sd">              ``some_file_1.sqlite3`` or if that also exists then</span>
<span class="sd">              ``some_file_2.sqlite3`` and so on.</span>
<span class="sd">        ext : str</span>
<span class="sd">            The extension that the filepath is ensured to end with.</span>

<span class="sd">            - If it is ``None``, no extension is added.</span>
<span class="sd">            - If it is ``csv``, the filepath is ensured to end with</span>
<span class="sd">              ``.csv``.</span>
<span class="sd">            - If it is ``.csv``, the filepath is ensured to end with</span>
<span class="sd">              ``.csv``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filepath_used : str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepath_used</span> <span class="o">=</span> <span class="n">filepath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filepath_used</span> <span class="o">=</span> <span class="n">_utilities</span><span class="o">.</span><span class="n">operating_system</span><span class="o">.</span><span class="n">ensure_file_extension</span><span class="p">(</span>
                <span class="n">filepath</span><span class="p">,</span> <span class="n">ext</span>
            <span class="p">)</span>
        <span class="n">filepath_used</span> <span class="o">=</span> <span class="n">_utilities</span><span class="o">.</span><span class="n">operating_system</span><span class="o">.</span><span class="n">ensure_new_path</span><span class="p">(</span><span class="n">filepath_used</span><span class="p">)</span>

        <span class="c1"># Export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">export_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;full_search&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filepath_used</span></div>

<div class="viewcode-block" id="Database.import_sql"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.import_sql">[docs]</a>    <span class="k">def</span> <span class="nf">import_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import an evolutionary search by loading the SQL file of a previous run.</span>

<span class="sd">        Either all generations (default) or only a subset defined by the</span>
<span class="sd">        interval ``[first_generation, last_generation]`` can be loaded.</span>

<span class="sd">        Caution: The method :meth:`reset` is called, so that the current</span>
<span class="sd">        state and database are dropped and can be replaced in a clean</span>
<span class="sd">        fashion by new data from the SQL file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            Filepath of an SQLite3 file exported by a previous run.</span>
<span class="sd">        generation_range : `tuple` of two `int`, optional</span>
<span class="sd">            The first and last generation to include in the import.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Using ``first_generation=0`` and ``last_generation=2`` loads the</span>
<span class="sd">        first three generations of a previous run. The last generation</span>
<span class="sd">        is reconstructed as population in memory, so that the search can</span>
<span class="sd">        be continued from this point. If :meth:`run_step()` is called,</span>
<span class="sd">        the last generation loaded from the database (2) is used to</span>
<span class="sd">        construct the next generation (3). The resulting search state</span>
<span class="sd">        can again be exported to an SQL file if desired.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">_ap</span><span class="o">.</span><span class="n">str_arg</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_import_database_error</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="c1"># Databases</span>
        <span class="n">source_db</span> <span class="o">=</span> <span class="n">_database</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">database_on</span><span class="p">:</span>
            <span class="n">target_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="c1"># Argument processing (with information from source database)</span>
        <span class="n">first_gen_in_db</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">generation_first</span><span class="p">()</span>
        <span class="n">last_gen_in_db</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">generation_last</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">first_gen</span> <span class="o">&lt;</span> <span class="n">first_gen_in_db</span> <span class="ow">or</span> <span class="n">first_gen</span> <span class="o">&gt;</span> <span class="n">last_gen_in_db</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">_warn_database_import_first</span><span class="p">(</span><span class="n">first_gen_in_db</span><span class="p">,</span> <span class="n">first_gen</span><span class="p">)</span>
            <span class="n">first_generation</span> <span class="o">=</span> <span class="n">first_gen_in_db</span>
        <span class="k">if</span> <span class="n">last_gen</span> <span class="o">&gt;</span> <span class="n">last_gen_in_db</span> <span class="ow">or</span> <span class="n">last_gen</span> <span class="o">&lt;</span> <span class="n">first_gen_in_db</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">_warn_database_import_last</span><span class="p">(</span><span class="n">last_gen_in_db</span><span class="p">,</span> <span class="n">last_gen</span><span class="p">)</span>
            <span class="n">last_generation</span> <span class="o">=</span> <span class="n">last_gen_in_db</span>

        <span class="c1"># Load subset from old db and store it into new db</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">database_on</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">_load_database_subset</span><span class="p">(</span><span class="n">first_generation</span><span class="p">,</span> <span class="n">last_generation</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;Tried to load the chosen data from SQL database &quot;</span><span class="si">{}</span><span class="s1">&quot; but the &#39;</span>
                    <span class="s2">&quot;resulting list was empty.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">target_db</span><span class="o">.</span><span class="n">_store_database_subset</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Reconstruct properties to determine current state</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">last_generation</span> <span class="o">-</span> <span class="n">first_generation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">with_parent_ids</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">with_parent_ids</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">last_population</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">_load_population</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">last_generation</span><span class="p">,</span> <span class="n">with_parent_ids</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_population</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;Tried to load the chosen data from SQL database &quot;</span><span class="si">{}</span><span class="s1">&quot; but the &#39;</span>
                <span class="s2">&quot;resulting list was empty.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">min_inds</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">individuals_with_min_fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">first_generation</span><span class="p">,</span> <span class="n">last_generation</span>
        <span class="p">)</span>
        <span class="n">min_ind</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">min_inds</span> <span class="k">else</span> <span class="n">min_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_inds</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">individuals_with_max_fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">first_generation</span><span class="p">,</span> <span class="n">last_generation</span>
        <span class="p">)</span>
        <span class="n">max_ind</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">max_inds</span> <span class="k">else</span> <span class="n">max_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_id</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">_individual_max_id</span><span class="p">([</span><span class="n">first_generation</span><span class="p">,</span> <span class="n">last_generation</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">max_id</span><span class="p">:</span>
            <span class="n">max_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Set current state, partly based on database content, partly fresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">last_population</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">generation</span> <span class="o">=</span> <span class="n">last_generation</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_generations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_individuals</span> <span class="o">=</span> <span class="n">max_id</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_gen_to_phe_evaluations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">num_phe_to_fit_evaluations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">best_individual</span> <span class="o">=</span> <span class="n">min_ind</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">best_individual</span> <span class="o">=</span> <span class="n">max_ind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">min_individual</span> <span class="o">=</span> <span class="n">min_ind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">max_individual</span> <span class="o">=</span> <span class="n">max_ind</span></div>

<div class="viewcode-block" id="Database.import_sql_evaluations"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.import_sql_evaluations">[docs]</a>    <span class="k">def</span> <span class="nf">import_sql_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import only phenotype-to-fitness evaluation data from an SQL file.</span>

<span class="sd">        This method allows to load phenotype-to-fitness calculations</span>
<span class="sd">        from a previous run. It is relevant when the objective funtion</span>
<span class="sd">        is computationally demanding and prevention of some</span>
<span class="sd">        recalculations may speed up the search significantly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filepath : str</span>
<span class="sd">            Filepath of an SQLite3 file exported by a previous run.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">_ap</span><span class="o">.</span><span class="n">str_arg</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_import_database_error</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Preparation of source and target database</span>
        <span class="n">source_db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">target_db</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Load data from source database, warn if it is empty</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM phenotype_fitness_mapping;&quot;</span>
        <span class="n">phe_fit_evaluations</span> <span class="o">=</span> <span class="n">source_db</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phe_fit_evaluations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_warnings</span><span class="o">.</span><span class="n">_warn_import_database_empty</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Store data in target database</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT OR IGNORE INTO phenotype_fitness_mapping VALUES (?, ?, ?);&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">phe_fit_evaluations</span><span class="p">:</span>
            <span class="n">target_db</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>

        <span class="c1"># Optional report</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">num_eval</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phe_fit_evaluations</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Loaded </span><span class="si">{}</span><span class="s2"> phenotype-to-fitness evaluations from &quot;</span>
                <span class="s2">&quot;external database at </span><span class="si">{}</span><span class="s2">.&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_eval</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

    <span class="c1"># Getting insights into stored information</span>
    <span class="c1"># - Counts</span>
<div class="viewcode-block" id="Database.num_generations"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_generations">[docs]</a>    <span class="k">def</span> <span class="nf">num_generations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of generations stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT MAX(generation)-MIN(generation)+1 FROM search;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Database.num_individuals"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_individuals">[docs]</a>    <span class="k">def</span> <span class="nf">num_individuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of individuals stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Note: individual_id is the primary key, hence counting does not require DISTINCT</span>

        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(individual_id) FROM search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(individual_id) FROM search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.num_genotypes"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_genotypes">[docs]</a>    <span class="k">def</span> <span class="nf">num_genotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of unique genotypes stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Note: Null is not considered in &#39;SELECT COUNT(DISTINCT genotype)&#39; but should never occur</span>

        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(DISTINCT genotype) FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(DISTINCT genotype) FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.num_phenotypes"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_phenotypes">[docs]</a>    <span class="k">def</span> <span class="nf">num_phenotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of unique phenotypes stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Note: Null would not be considered in &#39;SELECT COUNT(DISTINCT phenotype)&#39; but can occur</span>

        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM (&quot;</span>
                <span class="s2">&quot;  SELECT DISTINCT phenotype FROM full_search&quot;</span>
                <span class="s2">&quot;  WHERE label=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM (&quot;</span>
                <span class="s2">&quot;  SELECT DISTINCT phenotype FROM full_search&quot;</span>
                <span class="s2">&quot;  WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.num_fitnesses"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_fitnesses">[docs]</a>    <span class="k">def</span> <span class="nf">num_fitnesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of unique fitness values stored in the database.</span>

<span class="sd">        NaN values are not counted. These values appear in individuals</span>
<span class="sd">        that were not evaluated, e.g. those generated by crossover but</span>
<span class="sd">        then modified by mutation before being evaluated and selected.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: Null (NaN) is not considered in &#39;SELECT COUNT(DISTINCT fitness)&#39; but may occur</span>

        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM (&quot;</span>
                <span class="s2">&quot;  SELECT DISTINCT fitness FROM full_search&quot;</span>
                <span class="s2">&quot;  WHERE label=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM (&quot;</span>
                <span class="s2">&quot;  SELECT DISTINCT fitness FROM full_search&quot;</span>
                <span class="s2">&quot;  WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.num_details"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_details">[docs]</a>    <span class="k">def</span> <span class="nf">num_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of unique details stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Note: Null would not be considered in &#39;SELECT COUNT(DISTINCT details)&#39; but can occur</span>

        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM (&quot;</span>
                <span class="s2">&quot;  SELECT DISTINCT details FROM full_search&quot;</span>
                <span class="s2">&quot;  WHERE label=</span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT COUNT(*) FROM (&quot;</span>
                <span class="s2">&quot;  SELECT DISTINCT details FROM full_search&quot;</span>
                <span class="s2">&quot;  WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?&quot;</span>
                <span class="s2">&quot;);&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.num_gen_to_phe_evaluations"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_gen_to_phe_evaluations">[docs]</a>    <span class="k">def</span> <span class="nf">num_gen_to_phe_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of genotype-to-phenotype evaluations.&quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) FROM genotype_phenotype_mapping;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.num_phe_to_fit_evaluations"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.num_phe_to_fit_evaluations">[docs]</a>    <span class="k">def</span> <span class="nf">num_phe_to_fit_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_unique</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of phenotype-to-fitness evaluations.</span>

<span class="sd">        Note: It assumes that no phenotype was evaluated more than once,</span>
<span class="sd">        which depends on the parametrization (cache and/or database</span>
<span class="sd">        lookups).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">column</span> <span class="o">=</span> <span class="s2">&quot;DISTINCT(t1.phenotype)&quot;</span> <span class="k">if</span> <span class="n">only_unique</span> <span class="k">else</span> <span class="s2">&quot;t1.phenotype&quot;</span>

        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT COUNT(</span><span class="si">{}</span><span class="s2">) FROM genotype_phenotype_mapping AS t1 &quot;</span>
            <span class="s2">&quot;LEFT JOIN phenotype_fitness_mapping AS t2 &quot;</span>
            <span class="s2">&quot;ON t2.phenotype=t1.phenotype;&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="c1"># - Generation</span>
<div class="viewcode-block" id="Database.generation_first"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.generation_first">[docs]</a>    <span class="k">def</span> <span class="nf">generation_first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the first generation stored in the database.</span>

<span class="sd">        Raises an error if the database does not contain any entries yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT MIN(generation) FROM search;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_generation_first_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Database.generation_last"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.generation_last">[docs]</a>    <span class="k">def</span> <span class="nf">generation_last</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the last generation stored in the database.</span>

<span class="sd">        Raises an error if the database does not contain any entries yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT MAX(generation) FROM search;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_generation_last_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="k">def</span> <span class="nf">_process_generation_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process the user-provided generation range so it can be used safely in a query.&quot;&quot;&quot;</span>
        <span class="n">_ap</span><span class="o">.</span><span class="n">check_arg</span><span class="p">(</span>
            <span class="s2">&quot;generation_range&quot;</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">int</span><span class="p">,</span> <span class="n">_Iterable</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">generation_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">_Iterable</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">generation_range</span>
                <span class="k">if</span> <span class="n">first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_first</span><span class="p">()</span>
                    <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
                        <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_last</span><span class="p">()</span>
                    <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
                        <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
                <span class="n">generation_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">first</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_generation_range_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">generation_range</span>

    <span class="c1"># - Individual</span>
    <span class="k">def</span> <span class="nf">_individual_max_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the largest individual id stored in the database.</span>

<span class="sd">        Returns None if the database does not contain any entries yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT MAX(individual_id) FROM search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">label</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT MAX(individual_id) FROM search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_ind_max_id_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="Database.individuals"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.individuals">[docs]</a>    <span class="k">def</span> <span class="nf">individuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all individuals stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT * FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">individuals</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.individuals_with_given_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.individuals_with_given_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">individuals_with_given_fitness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fitness</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all individuals that have the same user-provided fitness value.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">fitness</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ? AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">fitness</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">individuals</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.individuals_with_min_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.individuals_with_min_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">individuals_with_min_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all individuals that have the same minimum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_min</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">individuals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">individuals</span></div>

<div class="viewcode-block" id="Database.individuals_with_max_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.individuals_with_max_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">individuals_with_max_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all individuals that have the same maximum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_max</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">individuals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">individuals</span></div>

<div class="viewcode-block" id="Database.individuals_with_low_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.individuals_with_low_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">individuals_with_low_fitness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the first n elements from a list of individuals sorted by lowest fitness.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND fitness IS NOT NULL &quot;</span>
                <span class="s2">&quot;ORDER BY fitness ASC &quot;</span>
                <span class="s2">&quot;LIMIT ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ? AND fitness IS NOT NULL &quot;</span>
                <span class="s2">&quot;ORDER BY fitness ASC &quot;</span>
                <span class="s2">&quot;LIMIT ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">individuals</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.individuals_with_high_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.individuals_with_high_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">individuals_with_high_fitness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the first n individuals, when all of them are sorted by hightest fitness.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND fitness IS NOT NULL &quot;</span>
                <span class="s2">&quot;ORDER BY fitness DESC &quot;</span>
                <span class="s2">&quot;LIMIT ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ? AND fitness IS NOT NULL &quot;</span>
                <span class="s2">&quot;ORDER BY fitness DESC &quot;</span>
                <span class="s2">&quot;LIMIT ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">individuals</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    <span class="c1"># - Population</span>
<div class="viewcode-block" id="Database.population_size_min"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.population_size_min">[docs]</a>    <span class="k">def</span> <span class="nf">population_size_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get smallest population size of any generation stored in the database.</span>

<span class="sd">        Raises an error if the database does not contain any entries yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT MIN(population_size) FROM (&quot;</span>
            <span class="s2">&quot;  SELECT COUNT(label) AS population_size FROM search &quot;</span>
            <span class="s1">&#39;  WHERE label=&quot;main&quot; GROUP BY generation&#39;</span>
            <span class="s2">&quot;);&quot;</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_pop_size_min_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Database.population_size_max"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.population_size_max">[docs]</a>    <span class="k">def</span> <span class="nf">population_size_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get largest population size of any generation stored in the database.</span>

<span class="sd">        Raises an error if the database does not contain any entries yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT MAX(population_size) FROM (&quot;</span>
            <span class="s2">&quot;  SELECT COUNT(label) AS population_size FROM search &quot;</span>
            <span class="s1">&#39;  WHERE label=&quot;main&quot; GROUP BY generation&#39;</span>
            <span class="s2">&quot;);&quot;</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_pop_size_max_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="c1"># - Genotype</span>
<div class="viewcode-block" id="Database.genotypes"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.genotypes">[docs]</a>    <span class="k">def</span> <span class="nf">genotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get unique genotypes stored in the database.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT DISTINCT genotype FROM search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">label</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT genotype FROM search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">genotypes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.genotypes_with_given_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.genotypes_with_given_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">genotypes_with_given_fitness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fitness</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get unique genotypes that have the same user-provided fitness value.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT genotype FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">fitness</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT genotype FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ? AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">fitness</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">genotypes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.genotypes_with_min_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.genotypes_with_min_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">genotypes_with_min_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique genotypes that have the same minimum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_min</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">genotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotypes_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">genotypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">genotypes</span></div>

<div class="viewcode-block" id="Database.genotypes_with_max_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.genotypes_with_max_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">genotypes_with_max_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique genotypes that have the same maximum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_max</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">genotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotypes_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">genotypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">genotypes</span></div>

    <span class="c1"># - Phenotype</span>
<div class="viewcode-block" id="Database.phenotypes"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.phenotypes">[docs]</a>    <span class="k">def</span> <span class="nf">phenotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique phenotypes.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT phenotype FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT phenotype FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">phenotypes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.phenotypes_with_given_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.phenotypes_with_given_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">phenotypes_with_given_fitness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fitness</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique phenotypes that have the same user-provided fitness value.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT phenotype FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">fitness</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT phenotype FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ? AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">fitness</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">phenotypes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.phenotypes_with_min_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.phenotypes_with_min_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">phenotypes_with_min_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique phenotypes that have the same minimum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_min</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">phenotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phenotypes_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">phenotypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">phenotypes</span></div>

<div class="viewcode-block" id="Database.phenotypes_with_max_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.phenotypes_with_max_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">phenotypes_with_max_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique phenotypes that have the same minimum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_max</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">phenotypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phenotypes_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">phenotypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">phenotypes</span></div>

    <span class="c1"># - Details (optionally returned by objective function during phenotype-fitness evaluation)</span>
<div class="viewcode-block" id="Database.details"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.details">[docs]</a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique details (returned by the objective function).&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT details FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT details FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">multiple_details</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.details_with_given_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.details_with_given_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">details_with_given_fitness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fitness</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique details that have the same user-provided fitness value.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT details FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">fitness</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT details FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ? AND fitness=?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">fitness</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">multiple_details</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.details_with_min_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.details_with_min_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">details_with_min_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique details that have the same minimum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_min</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">details_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">details</span></div>

<div class="viewcode-block" id="Database.details_with_max_fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.details_with_max_fitness">[docs]</a>    <span class="k">def</span> <span class="nf">details_with_max_fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique details that have the same maximum fitness value.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness_max</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
            <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">details_with_given_fitness</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_exceptions</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">:</span>
            <span class="n">details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">details</span></div>

    <span class="c1"># - Fitness</span>
<div class="viewcode-block" id="Database.fitnesses"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.fitnesses">[docs]</a>    <span class="k">def</span> <span class="nf">fitnesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load unique fitness values.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT fitness FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT DISTINCT fitness FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitnesses</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.fitness_min"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.fitness_min">[docs]</a>    <span class="k">def</span> <span class="nf">fitness_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the minimum fitness value that was found.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT MIN(fitness) FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">label</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT MIN(fitness) FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># if NaN</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_fitness_min_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Database.fitness_max"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.fitness_max">[docs]</a>    <span class="k">def</span> <span class="nf">fitness_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the maximum fitness value that was found.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">generation_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&quot;main&quot;&#39;</span> <span class="k">if</span> <span class="n">only_main</span> <span class="k">else</span> <span class="s2">&quot;label&quot;</span>

        <span class="c1"># Query</span>
        <span class="k">if</span> <span class="n">generation_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SELECT MAX(fitness) FROM full_search &quot;</span> <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2">;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">label</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT MAX(fitness) FROM full_search &quot;</span>
                <span class="s2">&quot;WHERE label=</span><span class="si">{}</span><span class="s2"> AND generation BETWEEN ? AND ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">)</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># if NaN</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_fitness_max_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Database.fitness_min_after_num_evals"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.fitness_min_after_num_evals">[docs]</a>    <span class="k">def</span> <span class="nf">fitness_min_after_num_evals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_evaluations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the minimum fitness value that was found after a number of fitness evaluations.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">_ap</span><span class="o">.</span><span class="n">int_arg</span><span class="p">(</span><span class="s2">&quot;num_evaluations&quot;</span><span class="p">,</span> <span class="n">num_evaluations</span><span class="p">,</span> <span class="n">min_incl</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT MIN(fitness) from (&quot;</span>
            <span class="s2">&quot;  SELECT fitness FROM genotype_phenotype_mapping AS t1 &quot;</span>
            <span class="s2">&quot;  LEFT JOIN phenotype_fitness_mapping AS t2 &quot;</span>
            <span class="s2">&quot;  ON t2.phenotype=t1.phenotype &quot;</span>
            <span class="s2">&quot;  LIMIT ?&quot;</span>
            <span class="s2">&quot;);&quot;</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">num_evaluations</span><span class="p">,))</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># if NaN</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_fitness_min_n_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Database.fitness_max_after_num_evals"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.fitness_max_after_num_evals">[docs]</a>    <span class="k">def</span> <span class="nf">fitness_max_after_num_evals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_evaluations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the maximum fitness value that was found after a number of fitness evaluations.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">_ap</span><span class="o">.</span><span class="n">int_arg</span><span class="p">(</span><span class="s2">&quot;num_evaluations&quot;</span><span class="p">,</span> <span class="n">num_evaluations</span><span class="p">,</span> <span class="n">min_incl</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SELECT MAX(fitness) from (&quot;</span>
            <span class="s2">&quot;  SELECT fitness FROM genotype_phenotype_mapping AS t1 &quot;</span>
            <span class="s2">&quot;  LEFT JOIN phenotype_fitness_mapping AS t2 &quot;</span>
            <span class="s2">&quot;  ON t2.phenotype=t1.phenotype &quot;</span>
            <span class="s2">&quot;  LIMIT ?&quot;</span>
            <span class="s2">&quot;);&quot;</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">num_evaluations</span><span class="p">,))</span>

        <span class="c1"># Check</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># if NaN</span>
            <span class="n">_exceptions</span><span class="o">.</span><span class="n">raise_fitness_max_n_error</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="c1"># - Genotype-phenotype evaluations</span>
<div class="viewcode-block" id="Database.gen_to_phe_evaluations"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.gen_to_phe_evaluations">[docs]</a>    <span class="k">def</span> <span class="nf">gen_to_phe_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_evaluations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get genotype-to-phenotype evaluations that were performed during the search.</span>

<span class="sd">        Guaranteed:</span>
<span class="sd">        - The order of the list is the order of performed evaluations.</span>

<span class="sd">        Not guaranteed:</span>
<span class="sd">        - The same evaluations may have been performed multiple times during the run,</span>
<span class="sd">          depending on cache settings, which is not available as information in the</span>
<span class="sd">          database.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_evaluations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM genotype_phenotype_mapping;&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM genotype_phenotype_mapping LIMIT ?;&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">num_evaluations</span><span class="p">,))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">gt_phe_map</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    <span class="c1"># - Phenotype-fitness evaluations</span>
<div class="viewcode-block" id="Database.phe_to_fit_evaluations"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.phe_to_fit_evaluations">[docs]</a>    <span class="k">def</span> <span class="nf">phe_to_fit_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_evaluations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_details</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get phenotype-to-fitness evaluations that were performed during the search.</span>

<span class="sd">        Guaranteed:</span>
<span class="sd">        - The order of the list is the order of performed evaluations.</span>
<span class="sd">        - Genotype-phenotype pairs that were loaded from previous runs are not considered.</span>

<span class="sd">        Not guaranteed:</span>
<span class="sd">        - The same evaluations may have been performed multiple times during the run,</span>
<span class="sd">          depending on cache and database lookup settings, which is not available</span>
<span class="sd">          as information in the database.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="k">if</span> <span class="n">with_details</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="s2">&quot;DISTINCT(t1.phenotype), fitness, details&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="s2">&quot;DISTINCT(t1.phenotype), fitness&quot;</span>

        <span class="c1"># Query</span>
        <span class="c1"># Note: Uses genotype_phenotype_mapping to get the right order of phenotypes and</span>
        <span class="c1"># not be influenced by potentially external data present in phenotype_fitness_mapping.</span>
        <span class="k">if</span> <span class="n">num_evaluations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT </span><span class="si">{}</span><span class="s2"> FROM genotype_phenotype_mapping AS t1 &quot;</span>
                <span class="s2">&quot;LEFT JOIN phenotype_fitness_mapping AS t2 &quot;</span>
                <span class="s2">&quot;ON t2.phenotype=t1.phenotype;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;SELECT </span><span class="si">{}</span><span class="s2"> FROM genotype_phenotype_mapping AS t1 &quot;</span>
                <span class="s2">&quot;LEFT JOIN phenotype_fitness_mapping AS t2 &quot;</span>
                <span class="s2">&quot;ON t2.phenotype=t1.phenotype &quot;</span>
                <span class="s2">&quot;LIMIT ?;&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">num_evaluations</span><span class="p">,))</span>

        <span class="c1"># Conditional return</span>
        <span class="k">if</span> <span class="n">with_details</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">phe_fit_det_map</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">phe_fit_map</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    <span class="c1"># Support for memoization of phenotype-fitness mappings</span>
    <span class="k">def</span> <span class="nf">_lookup_phenotype_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phenotypes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get phenotype-to-fitness evaluations for all known phenotypes in a given list.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        - https://www.sqlite.org/limits.html</span>
<span class="sd">        - https://stackoverflow.com/questions/44012117/what-is-the-most-efficient-way-to-query-multiple-values-from-a-single-column-in</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Query</span>
        <span class="n">n_max</span> <span class="o">=</span> <span class="mi">999</span>  <span class="c1"># SQLITE_MAX_VARIABLE_NUMBER for SQLite versions prior to 3.32.0</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phenotypes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">n_max</span><span class="p">:</span>
            <span class="c1"># Split it into multiple queries if the list contains too many phenotypes</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n_max</span><span class="p">):</span>
                <span class="n">partial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phenotype_evaluations</span><span class="p">(</span><span class="n">phenotypes</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n_max</span><span class="p">])</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">partial</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Single query</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">phe</span><span class="p">)</span> <span class="k">for</span> <span class="n">phe</span> <span class="ow">in</span> <span class="n">phenotypes</span><span class="p">]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM phenotype_fitness_mapping WHERE phenotype IN (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">phenotype</span>
            <span class="n">fi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitness</span>
            <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">details</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ph</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">fi</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">de</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Data representations</span>
<div class="viewcode-block" id="Database.to_list"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.to_list">[docs]</a>    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the database entries to a list of rows and add some derived information.</span>

<span class="sd">        It uses lazy loading, i.e. it is only constructed again if the database</span>
<span class="sd">        has changed since the last call.</span>

<span class="sd">        The first list entry contains the column names.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">create_list</span><span class="p">():</span>
            <span class="c1"># Load entries</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM full_search;&quot;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="c1"># Deserialize entries and derive new information</span>
            <span class="k">def</span> <span class="nf">safe_len</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="c1"># contained</span>
                    <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># individual_id [int]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">parent_ids</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># parent_ids [list, None]</span>
                    <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="c1"># generation [int]</span>
                    <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="c1"># label [str]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">genotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>  <span class="c1"># genotype [Genotype]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">phenotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>  <span class="c1"># phenotype [str, None]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>  <span class="c1"># fitness [float, NaN]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_deserializer</span><span class="o">.</span><span class="n">details</span><span class="p">(</span>
                        <span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                    <span class="p">),</span>  <span class="c1"># details [None, JSON object, str]</span>
                    <span class="c1"># derived</span>
                    <span class="n">safe_len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>  <span class="c1"># genotype_length [int]</span>
                    <span class="n">safe_len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>  <span class="c1"># phenotype_length [int]</span>
                    <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># rank [int] (calculated later)</span>
                <span class="p">]</span>

            <span class="c1"># Rank calculation for each population</span>
            <span class="k">def</span> <span class="nf">assign_ranks</span><span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">):</span>
                <span class="c1"># Sort a completed generation by fitness, derive ranks and assign them</span>
                <span class="k">if</span> <span class="n">fitnesses</span><span class="p">:</span>
                    <span class="n">rank_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fitnesses</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>  <span class="c1"># consider entries -n to -1</span>
                    <span class="n">rank_idx_fit</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rank_idx</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">))</span>
                    <span class="n">rank_idx_fit</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>  <span class="c1"># sort by fitness to distribute ranks</span>
                    <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="p">(</span><span class="n">rank_idx</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rank_idx_fit</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">row_idx</span> <span class="o">-</span> <span class="n">rank_idx</span><span class="p">][</span>
                            <span class="mi">10</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="n">rank</span>  <span class="c1"># assign ranks to entries -n to -1</span>

            <span class="n">last_label</span> <span class="o">=</span> <span class="s2">&quot;invalid label&quot;</span>
            <span class="n">last_generation</span> <span class="o">=</span> <span class="s2">&quot;invalid generation&quot;</span>
            <span class="n">fitnesses</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">generation</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">fitness</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">generation</span> <span class="o">!=</span> <span class="n">last_generation</span> <span class="ow">or</span> <span class="n">label</span> <span class="o">!=</span> <span class="n">last_label</span><span class="p">:</span>
                    <span class="n">assign_ranks</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">)</span>
                    <span class="n">fitnesses</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">last_generation</span> <span class="o">=</span> <span class="n">generation</span>
                <span class="n">last_label</span> <span class="o">=</span> <span class="n">label</span>
                <span class="n">fitnesses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fitness</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">assign_ranks</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fitnesses</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="c1"># Calculation or lookup in cache</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_or_calc</span><span class="p">(</span><span class="s2">&quot;to_list&quot;</span><span class="p">,</span> <span class="n">create_list</span><span class="p">)</span>

        <span class="c1"># Optional filtering</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_list</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Database.to_columns"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.to_columns">[docs]</a>    <span class="k">def</span> <span class="nf">to_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the columns available in all data.&quot;&quot;&quot;</span>
        <span class="c1"># primary source of truth about columns in data</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;individual_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_ids&quot;</span><span class="p">,</span>
            <span class="s2">&quot;generation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">,</span>
            <span class="s2">&quot;genotype&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phenotype&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fitness&quot;</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">,</span>
            <span class="s2">&quot;genotype_length&quot;</span><span class="p">,</span>
            <span class="s2">&quot;phenotype_length&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rank&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">columns</span></div>

<div class="viewcode-block" id="Database.to_dataframe"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.to_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the database entries to a Pandas DataFrame.</span>

<span class="sd">        Some derived information is added during the conversion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        only_main_populations : bool</span>
<span class="sd">            From the complete dataframe, only main populations are kept</span>
<span class="sd">            and intermediate ones (selected parents, crossed-over or</span>
<span class="sd">            mutated populations) are filtered out. Note that the</span>
<span class="sd">            crossed-over population is not evaluated if a mutation</span>
<span class="sd">            operator is provided, so that they have no associated</span>
<span class="sd">            phenotype and fitness values.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        - https://docs.python.org/3/library/sqlite3.html#sqlite3.Connection.total_changes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">pandas</span>

        <span class="c1"># Input data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_columns</span><span class="p">()</span>

        <span class="c1"># DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Database.to_network"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.to_network">[docs]</a>    <span class="k">def</span> <span class="nf">to_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the database entries to NetworkX graph and add some derived information.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

        <span class="c1"># Input data</span>
        <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_graph</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>

        <span class="c1"># Graph</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

        <span class="c1"># Nodes</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_columns</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;form&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">row</span><span class="p">)}</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;hover&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>

        <span class="c1"># Edges</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;parent_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individual_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individual_x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individual_y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individual_z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;parent_z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individual_label&quot;</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">,</span>
            <span class="s2">&quot;color&quot;</span><span class="p">,</span>
            <span class="s2">&quot;width&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individual_generation&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span></div>

<div class="viewcode-block" id="Database.to_jgf"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.to_jgf">[docs]</a>    <span class="k">def</span> <span class="nf">to_jgf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the data into JSON graph format for visualization.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">create_jgf</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
            <span class="c1"># Graph as dictionary in JSON graph format</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;graph&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">gn</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="s2">&quot;graph&quot;</span><span class="p">][</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span>
            <span class="n">ge</span> <span class="o">=</span> <span class="n">graph</span><span class="p">[</span><span class="s2">&quot;graph&quot;</span><span class="p">][</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span>

            <span class="c1"># Nodes</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_columns</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;form&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="c1"># Adapt coordinats (which fit only for Matplotlib and Plotly)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">25</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
                <span class="n">hover</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">val</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;phenotype&quot;</span><span class="p">,</span> <span class="s2">&quot;fitness&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                        <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span>
                        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
                        <span class="s2">&quot;hover&quot;</span><span class="p">:</span> <span class="n">hover</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="n">gn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="c1"># Edges</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;parent_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;individual_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;individual_x&quot;</span><span class="p">,</span>
                <span class="s2">&quot;parent_x&quot;</span><span class="p">,</span>
                <span class="s2">&quot;individual_y&quot;</span><span class="p">,</span>
                <span class="s2">&quot;parent_y&quot;</span><span class="p">,</span>
                <span class="s2">&quot;individual_z&quot;</span><span class="p">,</span>
                <span class="s2">&quot;parent_z&quot;</span><span class="p">,</span>
                <span class="s2">&quot;individual_label&quot;</span><span class="p">,</span>
                <span class="s2">&quot;style&quot;</span><span class="p">,</span>
                <span class="s2">&quot;color&quot;</span><span class="p">,</span>
                <span class="s2">&quot;width&quot;</span><span class="p">,</span>
                <span class="s2">&quot;individual_generation&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
                        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="n">ge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">graph</span>

        <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_graph</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">create_jgf</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_to_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the data to a graph object.&quot;&quot;&quot;</span>
        <span class="c1"># Given data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

        <span class="c1"># Calculation or lookup in cache: only new information, not contained in given data</span>
        <span class="k">def</span> <span class="nf">create_network</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">population_size_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">population_size_max</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_nodes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">population_size_max</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_edges</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span>

        <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_or_calc</span><span class="p">(</span><span class="s2">&quot;_to_graph&quot;</span><span class="p">,</span> <span class="n">create_network</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># Combination: merge given and calculated/cached data</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>

        <span class="c1"># Optional filtering</span>
        <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_graph</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span>

    <span class="k">def</span> <span class="nf">_to_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">population_size_max</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the data to nodes for a graph.&quot;&quot;&quot;</span>
        <span class="c1"># Default values</span>
        <span class="n">default_size</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">default_form</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span>
        <span class="n">default_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
        <span class="n">color_for_new_phenotypes</span> <span class="o">=</span> <span class="s2">&quot;#00CC00&quot;</span>
        <span class="n">x_offset</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">y_offset</span> <span class="o">=</span> <span class="n">population_size_max</span>
        <span class="n">z_offset</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">x_stretch</span> <span class="o">=</span> <span class="mf">0.85</span>

        <span class="c1"># Node data generation</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen_phenotypes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">generation</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">phenotype</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">fitness</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
            <span class="c1"># Coordinates</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">generation</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">rank</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">fitness</span>
            <span class="c1"># Use default values</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">default_size</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">default_form</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">default_color</span>
            <span class="c1"># Adapt them with specific information</span>
            <span class="c1"># - Color nodes which represent newly created phenotypes that undergo fitness evaluation</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span> <span class="ow">or</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;mutation&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">phenotype</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_phenotypes</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">color_for_new_phenotypes</span>
            <span class="c1"># - Node positions and sizes</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="mf">2.0</span>
                <span class="n">seen_phenotypes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">phenotype</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;parent_selection&quot;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">-=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">x_stretch</span> <span class="o">-</span> <span class="n">x_offset</span>
                    <span class="n">y</span> <span class="o">*=</span> <span class="mf">0.5</span>
                    <span class="n">y</span> <span class="o">+=</span> <span class="n">y_offset</span>
                    <span class="n">z</span> <span class="o">+=</span> <span class="n">z_offset</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;crossover&quot;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">-=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">x_offset</span>
                    <span class="n">y</span> <span class="o">*=</span> <span class="mf">0.5</span>
                    <span class="n">y</span> <span class="o">+=</span> <span class="n">y_offset</span>
                    <span class="n">z</span> <span class="o">+=</span> <span class="n">z_offset</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;mutation&quot;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">-=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">x_stretch</span> <span class="o">-</span> <span class="n">x_offset</span>
                    <span class="n">y</span> <span class="o">*=</span> <span class="mf">0.5</span>
                    <span class="n">y</span> <span class="o">+=</span> <span class="n">y_offset</span>
                    <span class="n">z</span> <span class="o">+=</span> <span class="n">z_offset</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">nodes</span>

    <span class="k">def</span> <span class="nf">_to_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the data to edges for a graph.&quot;&quot;&quot;</span>
        <span class="c1"># Default values</span>
        <span class="n">default_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
        <span class="n">default_width</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">default_style</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span>

        <span class="c1"># Edge data generation</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lookback_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="c1"># individual_id, parent_ids, generation, label, genotype, phenotype, fitness, details,</span>
            <span class="c1"># genotype_length, phenotype_length, rank</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">individual_parent_ids</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">individual_generation</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">individual_label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">individual_genotype</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="c1"># x, y, z, form, color, size</span>
            <span class="n">individual_x</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
            <span class="n">individual_y</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
            <span class="n">individual_z</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
            <span class="n">individual_color</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
            <span class="n">lookback_index</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">for</span> <span class="n">parent_id</span> <span class="ow">in</span> <span class="n">individual_parent_ids</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parent_idx</span> <span class="o">=</span> <span class="n">lookback_index</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">parent_row</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">parent_idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">[</span><span class="n">parent_idx</span><span class="p">]</span>
                <span class="n">parent_label</span> <span class="o">=</span> <span class="n">parent_row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">parent_genotype</span> <span class="o">=</span> <span class="n">parent_row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">parent_x</span> <span class="o">=</span> <span class="n">parent_row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">parent_y</span> <span class="o">=</span> <span class="n">parent_row</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">parent_z</span> <span class="o">=</span> <span class="n">parent_row</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
                <span class="c1"># Use default values</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">default_color</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">default_width</span>
                <span class="n">style</span> <span class="o">=</span> <span class="n">default_style</span>
                <span class="c1"># Adapt them with specific information</span>
                <span class="c1"># - Thicken identity relations from main population to main population</span>
                <span class="k">if</span> <span class="n">parent_label</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span> <span class="ow">and</span> <span class="n">individual_label</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>
                    <span class="n">width</span> <span class="o">*=</span> <span class="mi">4</span>
                <span class="c1"># - Color inheritance relations that lead to offspring with other gt than parents</span>
                <span class="k">if</span> <span class="n">individual_label</span> <span class="o">==</span> <span class="s2">&quot;crossover&quot;</span> <span class="ow">or</span> <span class="n">individual_label</span> <span class="o">==</span> <span class="s2">&quot;mutation&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">individual_genotype</span> <span class="o">!=</span> <span class="n">parent_genotype</span><span class="p">:</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;#EE0000&quot;</span>
                        <span class="n">width</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="c1"># - Color identity relations for nodes with newly discovered phenotype</span>
                <span class="k">if</span> <span class="n">parent_label</span> <span class="o">!=</span> <span class="s2">&quot;main&quot;</span> <span class="ow">and</span> <span class="n">individual_label</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">individual_color</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">parent_id</span><span class="p">,</span>  <span class="c1"># 0</span>
                    <span class="n">individual_id</span><span class="p">,</span>  <span class="c1"># 1</span>
                    <span class="n">individual_x</span><span class="p">,</span>  <span class="c1"># 2</span>
                    <span class="n">parent_x</span><span class="p">,</span>  <span class="c1"># 3</span>
                    <span class="n">individual_y</span><span class="p">,</span>  <span class="c1"># 4</span>
                    <span class="n">parent_y</span><span class="p">,</span>  <span class="c1"># 5</span>
                    <span class="n">individual_z</span><span class="p">,</span>  <span class="c1"># 6</span>
                    <span class="n">parent_z</span><span class="p">,</span>  <span class="c1"># 7</span>
                    <span class="n">individual_label</span><span class="p">,</span>  <span class="c1"># 8</span>
                    <span class="n">style</span><span class="p">,</span>  <span class="c1"># 9</span>
                    <span class="n">color</span><span class="p">,</span>  <span class="c1"># 10</span>
                    <span class="n">width</span><span class="p">,</span>  <span class="c1"># 11</span>
                    <span class="n">individual_generation</span><span class="p">,</span>  <span class="c1"># 12</span>
                <span class="p">)</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">edges</span>

    <span class="k">def</span> <span class="nf">_filter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter the data in list form.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">filter_gen</span> <span class="o">=</span> <span class="n">generation_range</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">filter_gen</span><span class="p">:</span>
            <span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>

        <span class="c1"># Quick check if any filter has to be applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">only_main</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filter_gen</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="c1"># Define the required filter</span>
        <span class="k">if</span> <span class="n">filter_gen</span> <span class="ow">and</span> <span class="n">only_main</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">first_gen</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">last_gen</span>

        <span class="k">elif</span> <span class="n">filter_gen</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">first_gen</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">last_gen</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span>

        <span class="c1"># Apply filter</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">keep</span><span class="p">(</span><span class="n">row</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_filter_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filter the data in graph form.&quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">filter_gen</span> <span class="o">=</span> <span class="n">generation_range</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">filter_gen</span><span class="p">:</span>
            <span class="n">first_gen</span><span class="p">,</span> <span class="n">last_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generation_range</span><span class="p">(</span><span class="n">generation_range</span><span class="p">)</span>

        <span class="c1"># Quick check if any filter has to be applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">only_main</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filter_gen</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span>

        <span class="c1"># Define the required filters</span>
        <span class="c1"># - node filter</span>
        <span class="k">if</span> <span class="n">filter_gen</span> <span class="ow">and</span> <span class="n">only_main</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">keep_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">used_ind_ids</span><span class="p">):</span>
                <span class="n">gn</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span> <span class="ow">and</span> <span class="n">gn</span> <span class="o">&gt;=</span> <span class="n">first_gen</span> <span class="ow">and</span> <span class="n">gn</span> <span class="o">&lt;=</span> <span class="n">last_gen</span><span class="p">:</span>
                    <span class="n">used_ind_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">elif</span> <span class="n">filter_gen</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">keep_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">used_ind_ids</span><span class="p">):</span>
                <span class="n">gn</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">gn</span> <span class="o">==</span> <span class="n">first_gen</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">gn</span> <span class="o">&gt;</span> <span class="n">first_gen</span> <span class="ow">and</span> <span class="n">gn</span> <span class="o">&lt;=</span> <span class="n">last_gen</span>
                <span class="p">):</span>
                    <span class="n">used_ind_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">keep_node</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">used_ind_ids</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>
                    <span class="n">used_ind_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># - edge filter</span>
        <span class="k">def</span> <span class="nf">keep_edge</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">used_ind_ids</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">used_ind_ids</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">used_ind_ids</span>

        <span class="c1"># Apply filters</span>
        <span class="n">used_ind_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">keep_node</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">used_ind_ids</span><span class="p">)]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">keep_edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">used_ind_ids</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span>

<div class="viewcode-block" id="Database.plot_genealogy"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Database.plot_genealogy">[docs]</a>    <span class="k">def</span> <span class="nf">plot_genealogy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;vis&quot;</span><span class="p">,</span> <span class="n">generation_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_main</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a genealogy plot.</span>

<span class="sd">        It shows the relationships between all individuals created</span>
<span class="sd">        throughout a run.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Argument processing</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">_ap</span><span class="o">.</span><span class="n">str_arg</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;d3&quot;</span><span class="p">,</span> <span class="s2">&quot;vis&quot;</span><span class="p">,</span> <span class="s2">&quot;three&quot;</span><span class="p">))</span>

        <span class="c1"># Data preparation</span>
        <span class="k">if</span> <span class="s2">&quot;edge_curvature&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;edge_curvature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="s2">&quot;show_node_label&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;show_node_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_jgf</span><span class="p">(</span><span class="n">generation_range</span><span class="p">,</span> <span class="n">only_main</span><span class="p">)</span>

        <span class="c1"># Plot</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">_plots</span><span class="o">.</span><span class="n">genealogy</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

    <span class="c1"># Caching</span>
    <span class="k">def</span> <span class="nf">_lookup_or_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">calc_func</span><span class="p">,</span> <span class="o">*</span><span class="n">calc_args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look up a result in the cache or calculate it.</span>

<span class="sd">        If it is not availabe yet in the cache, calculate it once and</span>
<span class="sd">        store it for later reuse.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbms</span><span class="o">.</span><span class="n">get_num_changes</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Cache lookup</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;num_changes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_changes</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
                <span class="n">result</span>
            <span class="p">)</span>  <span class="c1"># prevent shallow modification of original, deep too slow</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="c1"># Calculation</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">calc_func</span><span class="p">(</span><span class="o">*</span><span class="n">calc_args</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;num_changes&quot;</span><span class="p">:</span> <span class="n">num_changes</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Deserializer"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer">[docs]</a><span class="k">class</span> <span class="nc">Deserializer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convert database entries back to Python objects.&quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_system&quot;</span><span class="p">,)</span>

<div class="viewcode-block" id="Deserializer.__init__"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a deserializer that knows the chosen G3P system.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_system</span> <span class="o">=</span> <span class="n">system</span></div>

<div class="viewcode-block" id="Deserializer.individual_id"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.individual_id">[docs]</a>    <span class="k">def</span> <span class="nf">individual_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the id of an individual.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Deserializer.parent_ids"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.parent_ids">[docs]</a>    <span class="k">def</span> <span class="nf">parent_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the ids of parent individuals.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">_json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Deserializer.genotype"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.genotype">[docs]</a>    <span class="k">def</span> <span class="nf">genotype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a genotype.</span>

<span class="sd">        This generates a Genotype object. Its exact type depends on the</span>
<span class="sd">        grammar-based genetic programming system being used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_system</span><span class="o">.</span><span class="n">representation</span><span class="o">.</span><span class="n">Genotype</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="Deserializer.genotypes"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.genotypes">[docs]</a>    <span class="k">def</span> <span class="nf">genotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a list of genotypes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.phenotype"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.phenotype">[docs]</a>    <span class="k">def</span> <span class="nf">phenotype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a phenotypes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Deserializer.phenotypes"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.phenotypes">[docs]</a>    <span class="k">def</span> <span class="nf">phenotypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a list of phenotypes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">phenotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.fitness"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.fitness">[docs]</a>    <span class="k">def</span> <span class="nf">fitness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a fitness value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Deserializer.fitnesses"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.fitnesses">[docs]</a>    <span class="k">def</span> <span class="nf">fitnesses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a list of fitness values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.details"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.details">[docs]</a>    <span class="k">def</span> <span class="nf">details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a details object.&quot;&quot;&quot;</span>
        <span class="c1"># None</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># JSON</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># str</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Deserializer.multiple_details"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.multiple_details">[docs]</a>    <span class="k">def</span> <span class="nf">multiple_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a list of details objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.gt_phe_map"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.gt_phe_map">[docs]</a>    <span class="k">def</span> <span class="nf">gt_phe_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct genotype-to-phenotype mappings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">phenotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.phe_fit_map"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.phe_fit_map">[docs]</a>    <span class="k">def</span> <span class="nf">phe_fit_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct phenotype-to-fitness mappings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">phenotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.phe_fit_det_map"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.phe_fit_det_map">[docs]</a>    <span class="k">def</span> <span class="nf">phe_fit_det_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct phenotype-to-fitness-and-details mappings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phenotype</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.individual"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.individual">[docs]</a>    <span class="k">def</span> <span class="nf">individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">without_parent_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct an individual.</span>

<span class="sd">        This generates an Individual object. Its exact type depends on</span>
<span class="sd">        the grammar-based genetic programming system being used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Split row into values</span>
        <span class="n">ind_id</span><span class="p">,</span> <span class="n">par_ids</span><span class="p">,</span> <span class="n">gnr</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="n">phe</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">det</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># Special case: do not load parent ids</span>
        <span class="k">if</span> <span class="n">without_parent_ids</span><span class="p">:</span>
            <span class="n">par_ids</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Deserialization: convert each string from the database to a suitable Python object</span>
        <span class="n">ind_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individual_id</span><span class="p">(</span><span class="n">ind_id</span><span class="p">)</span>
        <span class="n">par_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_ids</span><span class="p">(</span><span class="n">par_ids</span><span class="p">)</span>
        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">genotype</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
        <span class="n">det</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>

        <span class="c1"># Object creation</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_system</span><span class="o">.</span><span class="n">representation</span><span class="o">.</span><span class="n">Individual</span><span class="p">(</span>
            <span class="n">genotype</span><span class="o">=</span><span class="n">gt</span><span class="p">,</span>
            <span class="n">phenotype</span><span class="o">=</span><span class="n">phe</span><span class="p">,</span>
            <span class="n">fitness</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span>
            <span class="n">details</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">ind_id</span><span class="p">,</span>
                <span class="n">parent_ids</span><span class="o">=</span><span class="n">par_ids</span><span class="p">,</span>
                <span class="n">evaluation</span><span class="o">=</span><span class="n">det</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ind</span></div>

<div class="viewcode-block" id="Deserializer.individuals"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.individuals">[docs]</a>    <span class="k">def</span> <span class="nf">individuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a list of individuals.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">individual</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_system</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span></div>

<div class="viewcode-block" id="Deserializer.population"><a class="viewcode-back" href="../../../../autoapi/alogos/_optimization/ea/database/index.html#alogos._optimization.ea.database.Deserializer.population">[docs]</a>    <span class="k">def</span> <span class="nf">population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reconstruct a population.</span>

<span class="sd">        This generates a Population object. Its exact type depends on</span>
<span class="sd">        the grammar-based genetic programming system being used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_system</span><span class="o">.</span><span class="n">representation</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Robert Haas.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>